function json_parse(t,e){void 0!==e&&e&&console.trace(t);let a=-1<t.search(/\{"success"\:/)?{success:0,validation_errors:0}:{};try{a=JSON.parse(t)}catch(e){var n='<h3>âš  Parse JSON error! <a href="#js-error" data-toggle="collapse" class="btn btn-default">ðŸ›ˆ</a></h3><div class="collapse" id="js-error">'+t+"</div>";setTimeout(function(){$("#content .alert-danger").length?$("#content .alert-danger").prepend(n):$("#content").prepend('<div class="alert alert-danger">'+n+"</div>")},100),console.error("Invalid JSON returned from server! data:",t)}finally{return a}}function insert_at_caret(e,t){var a,e=document.getElementById(e),n=e.scrollTop,l=0,o=e.selectionStart||"0"===e.selectionStart?"ff":!!document.selection&&"ie",r=("ie"===o?(e.focus(),(a=document.selection.createRange()).moveStart("character",-e.value.length),l=a.text.length):"ff"===o&&(l=e.selectionStart),e.value.substring(0,l)),c=e.value.substring(l,e.value.length);e.value=r+t+c,l+=t.length,"ie"===o?(e.focus(),(a=document.selection.createRange()).moveStart("character",-e.value.length),a.moveStart("character",l),a.moveEnd("character",0),a.select()):"ff"===o&&(e.selectionStart=l,e.selectionEnd=l,e.focus()),e.scrollTop=n}function inject_email_template(a,e){$.each(e,function(e,t){e=e.replace("email_template_",""),t&&-1<a.indexOf(e)&&$("#"+e).val(t).trigger("change")})}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}function insert_html_tag(e,t){var a,n,l,o,r,c;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-linebreak":a=["<br>",""];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}return n=document.getElementById(t),void 0!==document.selection?(n.focus(),c=document.selection.createRange().text):""!==n.selectionStart&&(l=n.selectionStart,o=n.selectionEnd,c=n.value.substring(l,o)),"text-css"===e?(r=a[0]+"\n\r"+n.value,$(n).val(r),update_email_template_preview(),!0):0===a[1].length?(insert_at_caret(t,a[0]),update_email_template_preview(),!0):(c&&c.length?(e=a[0]+c+a[1],c=n.value.length,r=n.value.substring(0,l)+e+n.value.substring(o,c),$(n).val(r)):insert_at_caret(t,a=a[0]+a[1]),void update_email_template_preview())}let csrf_token_name=document.querySelector('meta[name="csrf_token_name"]').getAttribute("content"),csrf_cookie_name=document.querySelector('meta[name="csrf_cookie_name"]').getAttribute("content"),legacy_calculation=parseInt(document.querySelector('meta[name="legacy_calculation"]').getAttribute("content"));function check_items_tax_usages(t){if(!legacy_calculation&&document.querySelector("#e_invoice_active")){let e;var a=[0,0],n=document.querySelectorAll('.item select[name="item_tax_rate_id"]');for(e=0;e<n.length;e++)0!=n[e].value?a[1]++:a[0]++,n[e].classList.remove("alert-danger"),$(n[e]).data("hasTaxEvent")||$(n[e]).on("change",check_items_tax_usages).data("hasTaxEvent",!0);if(0!=a[0]&&0!=a[1]){for(e=0;e<n.length;e++)n[e].classList.add("alert-danger");void 0!==t&&!0===t&&n[0].focus()}}}$(function(){$.ajaxPrefilter(function(e){"post"!==e.type&&"POST"!==e.type&&"Post"!==e.type||(""===e.data?e.data+="?"+csrf_token_name+"="+Cookies.get(csrf_cookie_name):e.data+="&"+csrf_token_name+"="+Cookies.get(csrf_cookie_name))}),$(document).ajaxComplete(function(){$('[name="'+csrf_token_name+'"]').val(Cookies.get(csrf_cookie_name))}),$("form").on("submit",function(){$('input[name="'+csrf_token_name+'"]').prop("value",Cookies.get(csrf_cookie_name))}),$.fn.select2.defaults.set("selectionCssClass",":all:");var e=$("#content"),t=$("html"),a=t.outerHeight()-$(".navbar").outerHeight()-$("#headerbar").outerHeight()-$("#submenu").outerHeight(),e=(e.outerHeight()<a&&e.outerHeight(a),t.click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")}),$('[data-toggle="tooltip"]').tooltip(),$(".simple-select").select2(),$("select.multiple-select").select2().on("select2:select",function(e){""==$(e.params.data.element).val()?$(this).val("").trigger("change.select2"):(e=$(this).select2("val")).length&&""==e[0]&&$(this).val(e.slice(1)).trigger("change.select2")}).on("select2:unselect",function(e){$(this).select2("val").length||$(this).val("").trigger("change.select2")}),new ClipboardJS(".to-clipboard"),$(".taggable").on("focus",function(){window.lastTaggableClicked=this}),$(".tag-select").select2().on("change",function(e){e=$(e.currentTarget);return void 0!==window.lastTaggableClicked&&insert_at_caret(window.lastTaggableClicked.id,e.val()),e.val([]),!1}),$(".html-tag").click(function(){insert_html_tag($(this).data("tagType"),$(".email-template-body").attr("id"))}),$(".email-template-body").attr("id")),n=($("#email_template_preview").empty()&&update_email_template_preview(),$(e).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()}),window.fullpage_loader=$("#fullpage-loader"),window.loader_error=$("#loader-error"),window.loader_icon=$("#loader-icon"),window.reset_loader=function(){loader_error.hide(),loader_icon.addClass("fa-spin").removeClass("text-danger"),clearTimeout(window.fullpageloaderTimeout)},window.close_loader=function(){fullpage_loader.fadeOut(200),reset_loader()},window.show_loader=function(e){e=e?parseInt(e):1e4,reset_loader(),fullpage_loader.fadeIn(200),window.fullpageloaderTimeout=window.setTimeout(function(){loader_error.fadeIn(200),loader_icon.removeClass("fa-spin").addClass("text-danger")},e)},$(document).on("click",".ajax-loader",function(){var e=$(this).closest("form");e.length&&!e[0].checkValidity()||show_loader()}),$(document).on("click",".fullpage-loader-close",function(){close_loader()}),$(".passwordmeter-input"));n&&n.on("input",function(){var e=zxcvbn(n.val());$(".passmeter-2, .passmeter-3").hide(),4===e.score?$(".passmeter-2, .passmeter-3").show():3===e.score&&$(".passmeter-2").show()}),$(document).on("keydown",function(e){e.ctrlKey&&"s"===e.key&&($(".modal-footer .btn-success:visible").length?(e.preventDefault(),$(".modal-footer .btn-success").click()):$("#headerbar .btn-success").length&&(e.preventDefault(),$("#headerbar .btn-success").click()))});let l=document.getElementById("settings[qr_code]"),o=document.getElementById("panel-qr-code-settings");l&&o&&l.addEventListener("click",()=>{o.querySelectorAll(".row").forEach(e=>{l.checked?e.classList.remove("hidden"):e.classList.add("hidden")})})});